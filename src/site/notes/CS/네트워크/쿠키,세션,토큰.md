---
{"dg-publish":true,"permalink":"/cs/네트워크/쿠키_세션_토큰/","dgPassFrontmatter":true,"noteIcon":""}
---


# 쿠키란?
- 브라우저에 저장되는 ==작은 텍스트 조각==이다.
- 브라우저는 사용자의 컴퓨터에 설치된 소프트웨어이므로 쿠키는 ==사용자가 가지고 있는 정보==이다.
- 사용자는 개발자 도구에서 쿠키를 수정, 삭제할수 있다.
- 누구나 볼 수 있기 때문에 ==개인정보나, 보안상 민감한 정보를 저장하는데 적합하지 않다. ==
- 자주 보는 웹툰 목록이나, 웹 페에지 다크모드 설정 여부 같은 <u>간단한 정보</u>를 저장하는데 적합하다. 
- 브라우저를 종료해도 데이터 유지


# 세션이란?
- ==서버가 사용자를 기억하고 있는 상태==를 말한다. 
- 브라우저 종료 시 데이터 삭제
- 장점
	- <u>안전</u>하다
	- 세션 데이터를 메모리에 올려두기에 <u>빠르게 확인</u>할 수 있다. 
- 단점
	- 메모리에 저장하기에 <u>공간이 한정</u>돼있다. 
	- 서버에 동시접속하는 사용자가 많아지면 메모리 공간이 부족해져서 서버에 부하가 걸리고 화면이 움직이지 않는 문제가 발생할 수 있다. 
	- 보조메모리는 저장공간은 훨씬 넓지만 메모리보다 시간이 오래걸려서 빠르고 많이 들어오는 요청에 맞게 세션 아이디를 찾아 확인하는 작업에는 메모리가 적합하다.


### 세션의 작동 방식

1. **서버가 세션 생성**: 사용자가 서버에 처음 접속하면 서버는 고유한 세션 ID를 생성하고, 세션 데이터를 서버에 저장합니다.
2. **세션 ID 쿠키 전송**: 서버는 클라이언트에게 ==세션 ID==를 🍪**쿠키**로 전송하며, 클라이언트는 이 세션 ID를 브라우저의 쿠키에 저장합니다.
	- 이때, `Set-Cookie` 헤더를 사용하여 세션 ID가 클라이언트에 전달됩니다.
3. **요청 시 쿠키로 세션 ID 포함**: 이후 클라이언트는 매 요청마다 **쿠키 헤더에 세션 ID를 자동으로 포함**하여 서버로 전송합니다.
4. **서버에서 세션 데이터 조회**: 서버는 쿠키에 포함된 세션 ID를 통해 세션 저장소에서 데이터를 조회해 사용자의 상태를 관리합니다.

### 쿠키와 세션의 라이프 사이클


- 세션 
	- 브라우저가 열려 있는 동안 또는 서버에서 설정한 타임아웃 시간 동안 유지
	- 서버에서 관리
- 쿠키
	- 유효 기간에 따라 지속성이 결정되며, 기본적으로 클라이언트에 저장
	- 유효 기간이 설정된 쿠키는 그 기간 동안 브라우저에 남아 있으며, 브라우저가 재시작되어도 유지됨
	- 유효 기간을 설정하지 않으면 브라우저가 열려 있는 동안만 유지됨



# 토큰이란?
- 메모리 공간을 많이 차지하는 ==세션 방식의 대안이 토큰 발급==이다. 
- 서버가 기억해 둘 필요 없이 ==사용자가 스스로를 증명해 두는 기술==이다. 
-  JWT (JSON Web Token) 가 많이 사용된다.
- 서버만이 유효한 토큰을 만들수 있고 보통 비밀키(Secret Key)를 사용해 서명한다.
- 토큰 생성 후 서버는 사용자의 정보를 메모리에 저장하지 않고 ==토큰 자체에 저장==해서 사용자에게 전달한다.
- 사용자는 토큰을 받은 후 쿠키로 저장해두고 서버는 클라이언트가 보낸 토큰이 유효한지 서명 검증을 통해 확인한다.
- 장점
	- 메모리에 저장하지 않기 때문에 서버의 부하를 줄이는 데 효과적임
- 단점
	-  한 번 발행한 토큰은 유효기간이 끝나기 전까지 따로 통제할 수 없기 때문에 세션에 비해 토큰 정보를 탈취당할 가능성이 높음 ?

#### 토큰의 작동 방식

1. **사용자 인증**: 사용자가 로그인 요청을 하면 서버는 사용자의 자격 증명을 확인합니다(예: 사용자명과 비밀번호)

2. **토큰 생성 및 발급**: 서버는 자격 증명이 성공하면, 해당 사용자에 대한 정보를 포함하는 JWT 토큰을 생성합니다. 이 토큰은 서버가 가진 **비밀키(Secret Key)**로 서명되어 위조를 방지합니다.

3. **응답 헤더에 토큰 포함**: 서버는 이 토큰을 응답 헤더에 담아 클라이언트로 보냅니다
 
4. **클라이언트에 토큰 저장**: 클라이언트는 이 토큰을 **쿠키나 로컬 스토리지**에 저장합니다.
 
5. **토큰 전송 및 인증**: 클라이언트는 이후 요청 시마다 **Authorization 헤더**에 토큰을 포함해 서버로 전송합니다.
 
6. **서버에서 토큰 검증**: 서버는 토큰의 서명을 검증하여, 해당 토큰이 유효한지 확인합니다. 토큰이 유효하다면, 토큰에 포함된 사용자 정보를 통해 **요청을 인증**합니다.

	💡 요청을 인증한다는 의미는? 
	
	-  **토큰의 유효성 검증**: 서버는 클라이언트가 보낸 토큰이 조작되지 않았고, 만료되지 않았는지 확인합니다. 보통 토큰은 서명(Signature)과 만료 시간(Expiration Time)을 포함하고 있으므로, 이를 통해 유효성을 검사합니다.
	
	- **사용자 정보 확인**: 토큰이 유효하다면, 서버는 토큰의 페이로드(payload)에서 **사용자 ID**나 **권한 수준**과 같은 정보를 확인합니다. 이를 통해 해당 사용자가 어떤 권한을 가지고 있는지 파악할 수 있습니다.
	
	-  **요청에 대한 권한 부여**: 토큰 검증 후 서버는 요청을 처리해도 안전하다고 판단하여 **요청을 승인**하고, 요청된 데이터를 반환하거나 해당 작업을 수행합니다.
    
7. **응답 처리**: 인증이 성공하면 서버는 요청을 처리하고, 응답을 클라이언트에 반환합니다.



# 세션과 토큰의 차이점

- **세션**: 상태를 서버에서 관리하므로 <u>사용자의 상태를 즉시 통제 가능</u>. 하지만 <u>메모리 부하</u>가 생길 수 있음.
- **토큰**: 서버가 상태를 직접 유지하지 않으므로 <u>메모리 부담은 적지만</u>, 토큰이 만료되기 전까지 <u>상태를 변경하거나 세션을 종료하는 데 제약</u>이 있음.


# 탈취 시 서버의 대응 차이

- 세션 ID와 토큰 모두 **클라이언트 측(브라우저의 쿠키)에 저장**되기 때문에 탈취의 위험이 존재합니다.
- 세션 ID가 탈취되면, **서버에서 즉시 폐기하고 재로그인을 유도할 수 있어 제어가 가능합니다**.
- 반면, 토큰은 **서버에서 직접 제어가 어려워** 탈취 시에는 **만료 시간을 짧게 설정하거나 사용자를 로그아웃시키는 방식으로 대응**합니다.




참고 사이트 :  [https://dev-coco.tistory.com/61](https://dev-coco.tistory.com/61) [슬기로운 개발생활:티스토리]
