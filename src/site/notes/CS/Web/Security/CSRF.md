---
{"dg-publish":true,"permalink":"/cs/web/security/csrf/","dgPassFrontmatter":true,"noteIcon":""}
---

## CSRF(Cross-Site Request Forgery)란?

- 악의적인 웹사이트가 사용자를 속여서, 사용자가 의도하지 않은 요청을 특정 웹 애플리케이션에 보내도록 만드는 ==웹사이트 취약점 공격 기법==
- 사용자가 <u>자신의 의지와는 무관하게</u> 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격을 말함


### CSRF 가 성공하기 위한 조건 세 가지
1. 사용자는 보안이 취약한 서버로부터 이미 로그인이 되어있는 상태여야 함
2. 쿠키 기반의 서버 세션정보를 획득할 수 있어야 함
	- CSRF는 **쿠키 기반 인증**이 적용된 시스템에서 발생함
	- 브라우저는 사용자가 요청을 보낼 때마다 서버로 자동으로 쿠키를 전송하는데 공격자는 이 동작을 악용하여 사용자의 브라우저로 악성 요청을 보낼 때도 세션 쿠키가 포함되도록 한다.
3. 공격자가 서버의 요청 방식을 미리 알고 있어야 함
	- 은행에 1000원을 이체시키는 작업을 예시로 들었을 때
		- 해당 서버의 요청 URL이 무엇인지`http://bank.com/transfer`
		- 어떤 HTTP 메서드로 전송되어야 하는지
		- 어떤 파라미터(예: `to=attacker_account`, `amount=1000` 등)가 요청에 포함되어야 하는지


### 공격 시나리오
1. 사용자가 A 은행 웹사이트에 로그인한 상태
2. 세션 쿠키가 브라우저에 저장되어 해당 세션 동안 은행과 사용자가 인증된 상태로 통신함
3. 공격자는 사용자에게 악성 웹사이트를 방문하게 함
	- 가짜 이메일or메시지, 흥미로운 내용처럼 보이는 링크 삽입 등등
4. 사용자가 이 악성 웹사이트를 방문하면, 사용자가 작성한 폼이 자동으로 제출되어 A 은행 웹사이트에 요청을 보냄
5. 이때, 사용자의 브라우저에는 이미 A 은행의 로그인 세션 쿠키가 있기 때문에, A 은행 서버는 이 요청이 인증된 사용자의 요청이라고 신뢰하고 처리함


### CSRF 공격을  방지하기 위해서는?

- CSRF 토큰 : 서버가 생성한 고유한 토큰을 요청에 포함하여 유효한 요청인지 확인
- SameSite 쿠키 : 외부 사이트에서 발생한 요청에 대해 쿠키가 전송되지 않도록 설정
- Referer 헤더 검사 : 요청이 신뢰할 수 있는 출처에서 온 것인지 확인
- GET 요청으로 데이터 변경 금지 : GET 요청은 조회 용도로만 사용하고, 중요한 작업은 POST, PUT 등을 사용
	- CSRF 공격은 모든 HTTP 메서드를 통해 발생할 수 있으나  그러나 GET 요청을 특히 주의해야 하는 이유는 GET 요청이 기본적으로 안전하지 않은 데이터 변경 작업에 사용되어서는 안 되기 때문임
- CAPTCHA 사용 : 요청 전 추가 인증 절차로 자동화된 공격 방지
- 타임아웃 세션 설정 : 세션 만료 시간을 짧게 설정하여 노출 위험 최소화




---
참고 사이트 : [CSRF란-우리-프로젝트는-CSRF에-취약한지-알아보기](https://velog.io/@smallcherry/CSRF%EB%9E%80-%EC%9A%B0%EB%A6%AC-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%8A%94-CSRF%EC%97%90-%EC%B7%A8%EC%95%BD%ED%95%9C%EC%A7%80-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)
